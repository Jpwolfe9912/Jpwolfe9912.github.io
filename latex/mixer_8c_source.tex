\hypertarget{mixer_8c_source}{}\doxysection{mixer.\+c}
\label{mixer_8c_source}\index{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/motion/mixer.c@{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/motion/mixer.c}}
\mbox{\hyperlink{mixer_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00009}00009 \textcolor{comment}{/* Includes */}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00010}00010 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{board_8h}{board.h}}"{}}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00011}00011 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00012}00012 \textcolor{comment}{/* Global Variables */}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00013}\mbox{\hyperlink{mixer_8c_ab1be7d8568140c9cd936664e74e866a5}{00013}} uint8\_t \mbox{\hyperlink{mixer_8c_ab1be7d8568140c9cd936664e74e866a5}{numberMotor}} = 4;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00014}\mbox{\hyperlink{mixer_8c_a819d556aa56c036590623a99955b0a7b}{00014}} uint16\_t \mbox{\hyperlink{mixer_8c_a819d556aa56c036590623a99955b0a7b}{throttleCmd}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00015}\mbox{\hyperlink{mixer_8c_aec1157580d2f27f5049e0093c2b1a84e}{00015}} int16\_t \mbox{\hyperlink{mixer_8c_a2cd3cf1f8b87bb342e3cbe4faaee86be}{steerCmd}}, \mbox{\hyperlink{mixer_8c_aec1157580d2f27f5049e0093c2b1a84e}{speedCmd}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00016}\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{00016}} int16\_t \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[4];}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00017}00017 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00022}00022 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00023}\mbox{\hyperlink{mixer_8c_af71213c328bfcf427bcab1d68ac8d65b}{00023}} \mbox{\hyperlink{mixer_8c_af71213c328bfcf427bcab1d68ac8d65b}{pulseMotors}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00024}00024 \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00025}00025     \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[0] = \mbox{\hyperlink{drv__dshot_8h_aaa1523141a62366e704d681c82094c0ca20b43b803dca25c31df35a92e9d6d4b5}{DSHOT\_CMD\_BEACON1}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00026}00026     \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[1] = \mbox{\hyperlink{drv__dshot_8h_aaa1523141a62366e704d681c82094c0ca20b43b803dca25c31df35a92e9d6d4b5}{DSHOT\_CMD\_BEACON1}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00027}00027     \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[2] = \mbox{\hyperlink{drv__dshot_8h_aaa1523141a62366e704d681c82094c0ca20b43b803dca25c31df35a92e9d6d4b5}{DSHOT\_CMD\_BEACON1}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00028}00028     \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[3] = \mbox{\hyperlink{drv__dshot_8h_aaa1523141a62366e704d681c82094c0ca20b43b803dca25c31df35a92e9d6d4b5}{DSHOT\_CMD\_BEACON1}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00029}00029     \mbox{\hyperlink{drv__system_8c_a7f2dfce1046bdd2a2b753643726c2346}{delay}}(10);}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00030}00030 \}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00031}00031 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00036}00036 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00037}\mbox{\hyperlink{mixer_8c_a53acefc5f5c00f0de5453c82a05fa8dd}{00037}} \mbox{\hyperlink{mixer_8c_a53acefc5f5c00f0de5453c82a05fa8dd}{mixTable}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00038}00038 \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00039}00039     uint8\_t i;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00040}00040 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00041}00041     \textcolor{keywordflow}{if}((\mbox{\hyperlink{process__commands_8c_abdda914a8c6ac0445832f7dbf4f37286}{mode}} == \mbox{\hyperlink{_autodrone32_8h_ada81cad6f64bf0042dba36096bf32710a1e3af4a87374fcc9dcb397ee98b47b65}{FLIGHT}}) \&\&}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00042}00042        (\mbox{\hyperlink{process__commands_8c_a8a1c07a2b10dfb3f7633b8db1d1dac4a}{armed}} == \textcolor{keyword}{true}))}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00043}00043     \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00044}00044         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[0] = \mbox{\hyperlink{mixer_8h_a01f41f3ca3e06ad102b8c2beaf0f3df9}{PIDMIXFLIGHT}}( -\/1.0f,  1.0f, -\/1.0f, 1.0f );      \textcolor{comment}{// Rear Right  CW}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00045}00045         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[1] = \mbox{\hyperlink{mixer_8h_a01f41f3ca3e06ad102b8c2beaf0f3df9}{PIDMIXFLIGHT}}( -\/1.0f, -\/1.0f,  1.0f, 1.0f );      \textcolor{comment}{// Front Right CCW}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00046}00046         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[2] = \mbox{\hyperlink{mixer_8h_a01f41f3ca3e06ad102b8c2beaf0f3df9}{PIDMIXFLIGHT}}(  1.0f,  1.0f,  1.0f, 1.0f );      \textcolor{comment}{// Rear Left   CCW}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00047}00047         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[3] = \mbox{\hyperlink{mixer_8h_a01f41f3ca3e06ad102b8c2beaf0f3df9}{PIDMIXFLIGHT}}(  1.0f, -\/1.0f, -\/1.0f, 1.0f );      \textcolor{comment}{// Front Left  CW}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00048}00048 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00049}00049         \textcolor{keywordtype}{float} maxDeltaThrottle;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00050}00050         \textcolor{keywordtype}{float} minDeltaThrottle;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00051}00051         \textcolor{keywordtype}{float} deltaThrottle;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00053}00053         maxDeltaThrottle = \mbox{\hyperlink{_autodrone32_8h_a1ca7e1fbdf49e02ec34430622f94f064}{MAXCOMMAND}} -\/ \mbox{\hyperlink{process__commands_8c_a1e10050fd5b2a267659f25847d7beb59}{rxCommands}}[\mbox{\hyperlink{_autodrone32_8h_a96e6d6c3e78916bb163b52f0ea38ba68}{THROTTLE}}];}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00054}00054         minDeltaThrottle = \mbox{\hyperlink{process__commands_8c_a1e10050fd5b2a267659f25847d7beb59}{rxCommands}}[\mbox{\hyperlink{_autodrone32_8h_a96e6d6c3e78916bb163b52f0ea38ba68}{THROTTLE}}] -\/ \mbox{\hyperlink{_autodrone32_8h_adda7ce5d0896385ad80c08bee2de8394}{eepromConfig}}.\mbox{\hyperlink{structeeprom_config__t_a15003441b8f0bb4c12c4f417e76e27a9}{minThrottle}};}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00055}00055         deltaThrottle    = (minDeltaThrottle < maxDeltaThrottle) ? minDeltaThrottle : maxDeltaThrottle;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00056}00056 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00057}00057         \textcolor{keywordflow}{for} (i = 0; i < \mbox{\hyperlink{mixer_8c_ab1be7d8568140c9cd936664e74e866a5}{numberMotor}}; i++)}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00058}00058         \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00059}00059             \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[i] = \mbox{\hyperlink{utilities_8c_aa81f27853b4b3674705ffa1c5658ae45}{constrain}}(\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[i], \mbox{\hyperlink{process__commands_8c_a1e10050fd5b2a267659f25847d7beb59}{rxCommands}}[\mbox{\hyperlink{_autodrone32_8h_a96e6d6c3e78916bb163b52f0ea38ba68}{THROTTLE}}] -\/ deltaThrottle, \mbox{\hyperlink{process__commands_8c_a1e10050fd5b2a267659f25847d7beb59}{rxCommands}}[\mbox{\hyperlink{_autodrone32_8h_a96e6d6c3e78916bb163b52f0ea38ba68}{THROTTLE}}] + deltaThrottle);}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00061}00061             \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[i] = ((\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[i] * \mbox{\hyperlink{mixer_8h_a99f5c7f8e5a3b995a995ab44f2c6f5e3}{THROTTLE\_DEADBAND\_SLOPE}}) + \mbox{\hyperlink{mixer_8h_ab05129e61621ca4133531558e59b2190}{THROTTLE\_DEADBAND}}) / 2 + 47;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00062}00062             \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[i] = \mbox{\hyperlink{utilities_8c_ae404b748d442c3f634e367bcf74e4da3}{constrain16}}(\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[i], 1237, 2047);}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00063}00063         \}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00064}00064     \}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00065}00065     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}((\mbox{\hyperlink{process__commands_8c_abdda914a8c6ac0445832f7dbf4f37286}{mode}} == \mbox{\hyperlink{_autodrone32_8h_ada81cad6f64bf0042dba36096bf32710a20364949ea9fb383c6b8baf4bf249c6a}{ROVER}}) \&\&}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00066}00066             (\mbox{\hyperlink{process__commands_8c_a8a1c07a2b10dfb3f7633b8db1d1dac4a}{armed}} == \textcolor{keyword}{true}))}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00067}00067     \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00068}00068 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00069}00069         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[0] = \mbox{\hyperlink{mixer_8h_a614580853a315063dde796faa3697c52}{PIDMIXROVER}}(  1.0f,  1.0f);    \textcolor{comment}{// front left}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00070}00070         \mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[1] = \mbox{\hyperlink{mixer_8h_a614580853a315063dde796faa3697c52}{PIDMIXROVER}}( -\/1.0f,  1.0f);    \textcolor{comment}{// front right}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00072}00072         \textcolor{keywordflow}{if}((\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[0] < 10) \&\& (\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[0] > -\/10))}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00073}00073             \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea2d2925398a9b00e63e7c37a1c710e02f}{MOTOR4}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00074}00074         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00075}00075             \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea2d2925398a9b00e63e7c37a1c710e02f}{MOTOR4}}] = \mbox{\hyperlink{utilities_8c_a017121a07e1620055423b251be444174}{dshot3dFormat}}(\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[0]);}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00076}00076 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00077}00077         \textcolor{keywordflow}{if}((\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[1] < 10) \&\& (\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[1] > -\/10))}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00078}00078             \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9eae45e87aca199d3774bfb21480eb7d934}{MOTOR2}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00079}00079         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00080}00080             \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9eae45e87aca199d3774bfb21480eb7d934}{MOTOR2}}] = \mbox{\hyperlink{utilities_8c_a017121a07e1620055423b251be444174}{dshot3dFormat}}(\mbox{\hyperlink{mixer_8c_ae9e762cff09b8093e89b0d0282e02107}{motor\_temp}}[1]);}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00081}00081 }
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00082}00082         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea492d91d9c76773912f54454e732c6a28}{MOTOR1}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00083}00083         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea5cc186b7500e7c6596d569dc8a39e7e3}{MOTOR3}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00084}00084     \}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00085}00085     \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00086}00086     \{}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00087}00087         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea492d91d9c76773912f54454e732c6a28}{MOTOR1}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00088}00088         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9eae45e87aca199d3774bfb21480eb7d934}{MOTOR2}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00089}00089         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea5cc186b7500e7c6596d569dc8a39e7e3}{MOTOR3}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00090}00090         \mbox{\hyperlink{motors_8c_ac96647f4976d16e8a084441dcfd5dcf8}{motor\_value}}[\mbox{\hyperlink{motors_8h_a52d59931063c311b3db496e3dd723b9ea2d2925398a9b00e63e7c37a1c710e02f}{MOTOR4}}] = 0;}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00091}00091     \}}
\DoxyCodeLine{\Hypertarget{mixer_8c_source_l00092}00092 \}}

\end{DoxyCode}
