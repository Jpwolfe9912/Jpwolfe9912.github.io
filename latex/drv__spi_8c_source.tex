\hypertarget{drv__spi_8c_source}{}\doxysection{drv\+\_\+spi.\+c}
\label{drv__spi_8c_source}\index{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/drv/drv\_spi.c@{/Users/jeremywolfe/Documents/STM32CubeIDE/Autodrone32/Src/drv/drv\_spi.c}}
\mbox{\hyperlink{drv__spi_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00001}00001 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00013}00013 \textcolor{comment}{/* Includes */}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00014}00014 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{board_8h}{board.h}}"{}}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00020}00020 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00021}\mbox{\hyperlink{drv__spi_8c_afdbacf07d926a145cc4d681c38980d03}{00021}} \mbox{\hyperlink{drv__spi_8c_afdbacf07d926a145cc4d681c38980d03}{spi1Init}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00022}00022 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00023}00023     printf(\textcolor{stringliteral}{"{}\(\backslash\)nInitializing SPI 1\(\backslash\)n"{}});}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00024}00024 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00025}00025     \textcolor{comment}{/* USER CODE BEGIN SPI1\_Init 0 */}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00027}00027     \textcolor{comment}{// enable clock for GPIOA}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00028}00028     RCC-\/>AHB1ENR |= RCC\_AHB1ENR\_GPIOAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00029}00029     \textcolor{comment}{// set mode, speed, type, pull, AF}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00030}00030     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER4;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00031}00031     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER4\_0;         \textcolor{comment}{// output mode}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00032}00032     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR4;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00033}00033     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT4;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00034}00034     GPIOA-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR4\_0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00035}00035     GPIOA-\/>AFR[0]   \&= \string~GPIO\_AFRL\_AFRL4;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00036}00036 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00037}00037     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER5;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00038}00038     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER5\_1;         \textcolor{comment}{// AF Mode}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00039}00039     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR5;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00040}00040     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT5;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00041}00041     GPIOA-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR5\_0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00042}00042     GPIOA-\/>AFR[0]   \&= \string~GPIO\_AFRL\_AFRL5;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00043}00043     GPIOA-\/>AFR[0]   |= (GPIO\_AF5\_SPI1 << (4U * 5U));\textcolor{comment}{// AF 5}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00044}00044 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00045}00045     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER6;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00046}00046     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER6\_1;         \textcolor{comment}{// AF mode}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00047}00047     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR6;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00048}00048     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT6;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00049}00049     GPIOA-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR6\_0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00050}00050     GPIOA-\/>AFR[0]   \&= \string~GPIO\_AFRL\_AFRL6;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00051}00051     GPIOA-\/>AFR[0]   |= (GPIO\_AF5\_SPI1 << (4U * 6U));\textcolor{comment}{// AF 5}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00052}00052 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00053}00053     GPIOA-\/>MODER    \&= \string~GPIO\_MODER\_MODER7;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00054}00054     GPIOA-\/>MODER    |= GPIO\_MODER\_MODER7\_1;         \textcolor{comment}{// AF mode}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00055}00055     GPIOA-\/>OSPEEDR  |= GPIO\_OSPEEDR\_OSPEEDR7;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00056}00056     GPIOA-\/>OTYPER   \&= \string~GPIO\_OTYPER\_OT7;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00057}00057     GPIOA-\/>PUPDR    |= GPIO\_PUPDR\_PUPDR7\_0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00058}00058     GPIOA-\/>AFR[0]   \&= \string~GPIO\_AFRL\_AFRL7;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00059}00059     GPIOA-\/>AFR[0]   |= (GPIO\_AF5\_SPI1 << (4U * 7U));\textcolor{comment}{// AF 5}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00060}00060 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00062}00062     \textcolor{comment}{// enable clock for SPI1}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00063}00063     RCC-\/>APB2ENR    |= RCC\_APB2ENR\_SPI1EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00065}00065     SPI1-\/>CR1       \&= \string~SPI\_CR1\_BIDIMODE;   \textcolor{comment}{// rx and tx}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00066}00066     SPI1-\/>CR1       |= SPI\_CR1\_MSTR;        \textcolor{comment}{// SPI master}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00067}00067     SPI1-\/>CR2       |= (0x7 << 8U);         \textcolor{comment}{// byte transfer size}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00068}00068     SPI1-\/>CR1       |= SPI\_CR1\_CPHA;        \textcolor{comment}{// high polarity}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00069}00069     SPI1-\/>CR1       |= SPI\_CR1\_CPOL;        \textcolor{comment}{// 2nd edge}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00070}00070     SPI1-\/>CR1       |= SPI\_CR1\_SSM;         \textcolor{comment}{// software slave management}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00071}00071     SPI1-\/>CR1       |= SPI\_CR1\_SSI;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00072}00072     SPI1-\/>CR1       |= (0x6 << 3U);         \textcolor{comment}{// 128 divider}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00073}00073     SPI1-\/>CR1       \&= \string~SPI\_CR1\_LSBFIRST;   \textcolor{comment}{// MSB first}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00074}00074     SPI1-\/>CR1       \&= \string~SPI\_CR1\_CRCEN;      \textcolor{comment}{// disable CRC}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00075}00075     SPI1-\/>CR2       \&= \string~(SPI\_CR2\_RXDMAEN |}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00076}00076                          SPI\_CR2\_TXDMAEN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00077}00077     SPI1-\/>CR1       |= SPI\_CR1\_SPE;         \textcolor{comment}{// enable SPI}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00078}00078 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00080}00080     \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00081}00081 \textcolor{comment}{     * SPI1\_RX on DMA2\_Stream0\_CH3}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00082}00082 \textcolor{comment}{     * SPI1\_TX on DMA2\_Stream3\_CH3}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00083}00083 \textcolor{comment}{     */}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00084}00084 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00085}00085     \textcolor{comment}{// disable DMA stream 1}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00086}00086     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00087}00087     \textcolor{keywordflow}{while}(DMA2\_Stream0-\/>CR \& DMA\_SxCR\_EN)\{\}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00088}00088     DMA2\_Stream0-\/>CR    = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00089}00089     DMA2\_Stream0-\/>NDTR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00090}00090     DMA2\_Stream0-\/>PAR   = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00091}00091     DMA2\_Stream0-\/>M0AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00092}00092     DMA2\_Stream0-\/>M1AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00093}00093     DMA2\_Stream0-\/>FCR   = 0x00000021U;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00094}00094     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_CHSEL;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00095}00095     DMA2-\/>LIFCR         |= 0x0000003FU;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00096}00096     \textcolor{comment}{// disable DMA stream 7}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00097}00097     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00098}00098     \textcolor{keywordflow}{while}(DMA2\_Stream3-\/>CR \& DMA\_SxCR\_EN)\{\}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00099}00099     DMA2\_Stream3-\/>CR    = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00100}00100     DMA2\_Stream3-\/>NDTR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00101}00101     DMA2\_Stream3-\/>PAR   = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00102}00102     DMA2\_Stream3-\/>M0AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00103}00103     DMA2\_Stream3-\/>M1AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00104}00104     DMA2\_Stream3-\/>FCR   = 0x00000021U;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00105}00105     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_CHSEL;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00106}00106     DMA2-\/>LIFCR         |= 0x0F400000U;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00107}00107 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00108}00108     \textcolor{comment}{// RX DMA settings}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00109}00109     DMA2\_Stream0-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00110}00110     DMA2\_Stream0-\/>M0AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00111}00111     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_DIR;           \textcolor{comment}{// per to mem}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00112}00112     DMA2\_Stream0-\/>FCR   \&= \string~DMA\_SxFCR\_DMDIS;        \textcolor{comment}{// fifo dis}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00113}00113     DMA2\_Stream0-\/>FCR   \&= \string~DMA\_SxFCR\_FTH;          \textcolor{comment}{//1/4 full}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00114}00114     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_MBURST;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00115}00115     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_PBURST;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00116}00116     DMA2\_Stream0-\/>PAR   = (uint32\_t)(\&(SPI1-\/>DR));}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00117}00117     DMA2\_Stream0-\/>NDTR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00118}00118     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_PINC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00119}00119     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_MINC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00120}00120     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_MSIZE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00121}00121     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_PSIZE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00122}00122     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_CIRC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00123}00123     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_PL;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00124}00124     \textcolor{comment}{// DMA transfer complete interrupt enable}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00125}00125     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_TCIE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00126}00126     \textcolor{comment}{// TX DMA settings}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00127}00127     DMA2\_Stream3-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00128}00128     DMA2\_Stream3-\/>M0AR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00129}00129     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_DIR\_0;          \textcolor{comment}{// mem to per}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00130}00130     DMA2\_Stream3-\/>FCR   \&= \string~DMA\_SxFCR\_DMDIS;        \textcolor{comment}{// fifo dis}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00131}00131     DMA2\_Stream3-\/>FCR   \&= \string~DMA\_SxFCR\_FTH;          \textcolor{comment}{//1/4 full}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00132}00132     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_MBURST;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00133}00133     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_PBURST;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00134}00134     DMA2\_Stream3-\/>PAR   = (uint32\_t)(\&(SPI1-\/>DR));}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00135}00135     DMA2\_Stream3-\/>NDTR  = 0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00136}00136     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_PINC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00137}00137     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_MINC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00138}00138     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_MSIZE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00139}00139     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_PSIZE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00140}00140     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_CIRC;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00141}00141     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_PL;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00142}00142     \textcolor{comment}{// DMA transfer complete interrupt enable}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00143}00143     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_TCIE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00144}00144 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00145}00145 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00153}00153 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00154}\mbox{\hyperlink{drv__spi_8c_ab223a09c3d0c71db42a9a8bbe2e388be}{00154}} \mbox{\hyperlink{drv__spi_8c_ab223a09c3d0c71db42a9a8bbe2e388be}{spiReadBytes}}(uint8\_t reg, uint8\_t *pData, uint8\_t size)}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00155}00155 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00156}00156     reg = reg | 0x80;           \textcolor{comment}{// read operation}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00157}00157 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00158}00158     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00159}00159     \textcolor{keywordflow}{while}(DMA2\_Stream0-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00160}00160     DMA2\_Stream0-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00161}00161     DMA2\_Stream0-\/>NDTR  = size;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00162}00162     DMA2\_Stream0-\/>M0AR  = (uint32\_t)pData;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00163}00163 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00164}00164     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00165}00165     \textcolor{keywordflow}{while}(DMA2\_Stream3-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00166}00166     DMA2\_Stream3-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00167}00167     DMA2\_Stream3-\/>NDTR  = size;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00168}00168     DMA2\_Stream3-\/>M0AR  = (uint32\_t)\&reg;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00169}00169 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00170}00170     \mbox{\hyperlink{drv__spi_8h_a969f555816dfb8f48a85c1795ff5e63d}{SPI1\_ENABLE}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00171}00171 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00172}00172     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00173}00173     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00174}00174 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00175}00175     SPI1-\/>CR2           |= SPI\_CR2\_RXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00176}00176     SPI1-\/>CR2           |= SPI\_CR2\_TXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00177}00177 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00178}00178     SPI1-\/>CR1           |= SPI\_CR1\_SPE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00179}00179 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00180}00180 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00188}00188 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00189}\mbox{\hyperlink{drv__spi_8c_a7d61fb36806c4e37a2bf675ba2d62008}{00189}} \mbox{\hyperlink{drv__spi_8c_a7d61fb36806c4e37a2bf675ba2d62008}{spiWriteBytes}}(uint8\_t *pData, uint8\_t size)}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00190}00190 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00191}00191     \textcolor{comment}{// RX Setup}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00192}00192     \textcolor{keyword}{volatile} uint8\_t dummy \mbox{\hyperlink{main_8c_a98fd71583f8abd1b1b12cfe80e3bd29a}{\_\_attribute\_\_}}((unused));}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00193}00193 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00194}00194     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00195}00195     \textcolor{keywordflow}{while}(DMA2\_Stream0-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00196}00196     DMA2\_Stream0-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00197}00197     DMA2\_Stream0-\/>NDTR  = size;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00198}00198     DMA2\_Stream0-\/>M0AR  = (uint32\_t)\&dummy;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00199}00199     \textcolor{comment}{// TX Setup}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00200}00200     \textcolor{comment}{// perhaps include a circular buffer}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00201}00201     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00202}00202     \textcolor{keywordflow}{while}(DMA2\_Stream3-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00203}00203     DMA2\_Stream3-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00204}00204     DMA2\_Stream3-\/>NDTR  = size;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00205}00205     DMA2\_Stream3-\/>M0AR  = (uint32\_t)pData;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00206}00206 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00207}00207     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_TCIE;       \textcolor{comment}{// RX interrupts}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00208}00208 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00209}00209     \mbox{\hyperlink{drv__spi_8h_a969f555816dfb8f48a85c1795ff5e63d}{SPI1\_ENABLE}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00210}00210 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00211}00211     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00212}00212     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00213}00213 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00214}00214     SPI1-\/>CR2           |= SPI\_CR2\_RXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00215}00215     SPI1-\/>CR2           |= SPI\_CR2\_TXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00216}00216 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00217}00217     SPI1-\/>CR1           |= SPI\_CR1\_SPE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00218}00218 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00219}00219 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00226}00226 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00227}\mbox{\hyperlink{drv__spi_8c_a3573b135702ff18ce4852e27547c4968}{00227}} \mbox{\hyperlink{drv__spi_8c_a3573b135702ff18ce4852e27547c4968}{spiReadOneByte}}(uint8\_t reg, uint8\_t *pData)}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00228}00228 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00229}00229     reg |= 0x80;        \textcolor{comment}{// read operation}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00230}00230 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00231}00231     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00232}00232     \textcolor{keywordflow}{while}(DMA2\_Stream0-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00233}00233     DMA2\_Stream0-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00234}00234     DMA2\_Stream0-\/>NDTR  = 3;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00235}00235     DMA2\_Stream0-\/>M0AR  = (uint32\_t)pData;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00236}00236 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00237}00237     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00238}00238     \textcolor{keywordflow}{while}(DMA2\_Stream3-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00239}00239     DMA2\_Stream3-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00240}00240     DMA2\_Stream3-\/>NDTR  = 3;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00241}00241     DMA2\_Stream3-\/>M0AR  = (uint32\_t)\&reg;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00242}00242 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00243}00243     \mbox{\hyperlink{drv__spi_8h_a969f555816dfb8f48a85c1795ff5e63d}{SPI1\_ENABLE}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00244}00244 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00245}00245     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00246}00246     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00247}00247 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00248}00248     SPI1-\/>CR2           |= SPI\_CR2\_RXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00249}00249     SPI1-\/>CR2           |= SPI\_CR2\_TXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00250}00250 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00251}00251     SPI1-\/>CR1           |= SPI\_CR1\_SPE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00252}00252 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00253}00253 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00260}00260 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00261}\mbox{\hyperlink{drv__spi_8c_aebb1dda4e95fbaba094d5beb79073279}{00261}} \mbox{\hyperlink{drv__spi_8c_aebb1dda4e95fbaba094d5beb79073279}{spiWriteOneByte}}(uint8\_t reg, uint8\_t data)}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00262}00262 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00263}00263     \textcolor{comment}{// need to pass in array of values to be written}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00264}00264     \textcolor{comment}{// RX Setup}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00265}00265     \textcolor{keyword}{volatile} uint8\_t dummy \mbox{\hyperlink{main_8c_a98fd71583f8abd1b1b12cfe80e3bd29a}{\_\_attribute\_\_}}((unused));}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00266}00266     uint8\_t \mbox{\hyperlink{drv__serial_8c_a3cc119cb1a4beab046568bd21fcac3e5}{temp}}[2] = \{reg, data\};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00267}00267 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00268}00268     DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00269}00269     \textcolor{keywordflow}{while}(DMA2\_Stream0-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00270}00270     DMA2\_Stream0-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00271}00271     DMA2\_Stream0-\/>NDTR  = 2;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00272}00272     DMA2\_Stream0-\/>M0AR  = (uint32\_t)\&dummy;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00273}00273     \textcolor{comment}{// TX Setup}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00274}00274     \textcolor{comment}{// perhaps include a circular buffer}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00275}00275     DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00276}00276     \textcolor{keywordflow}{while}(DMA2\_Stream3-\/>CR \& DMA\_SxCR\_EN);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00277}00277     DMA2\_Stream3-\/>CR    |= (0x3 << 25U);}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00278}00278     DMA2\_Stream3-\/>NDTR  = 2;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00279}00279     DMA2\_Stream3-\/>M0AR  = (uint32\_t)\mbox{\hyperlink{drv__serial_8c_a3cc119cb1a4beab046568bd21fcac3e5}{temp}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00280}00280 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00281}00281     \mbox{\hyperlink{drv__spi_8h_a969f555816dfb8f48a85c1795ff5e63d}{SPI1\_ENABLE}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00282}00282 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00283}00283     DMA2\_Stream0-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00284}00284     DMA2\_Stream3-\/>CR    |= DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00285}00285 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00286}00286     SPI1-\/>CR2           |= SPI\_CR2\_RXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00287}00287     SPI1-\/>CR2           |= SPI\_CR2\_TXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00288}00288 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00289}00289     SPI1-\/>CR1           |= SPI\_CR1\_SPE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00290}00290 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00291}00291 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00292}00292 \textcolor{comment}{/* Interrupt Handlers */}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00293}00293 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00297}00297 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00298}\mbox{\hyperlink{drv__spi_8c_aaf6ce196dde98712e1223b99766e06c0}{00298}} \mbox{\hyperlink{drv__spi_8c_aaf6ce196dde98712e1223b99766e06c0}{DMA2\_Stream0\_IRQHandler}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00299}00299 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00300}00300     \textcolor{keywordflow}{if}(DMA2-\/>LISR \& DMA\_LISR\_TCIF0)\{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00301}00301         DMA2-\/>LIFCR     |= DMA\_LIFCR\_CTCIF0;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00302}00302 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00303}00303         \mbox{\hyperlink{drv__spi_8h_af64f6dca6126f4fb9299c912c7f8ad81}{SPI1\_DISABLE}};}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00304}00304 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00305}00305         DMA2\_Stream0-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00306}00306         DMA2\_Stream3-\/>CR    \&= \string~DMA\_SxCR\_EN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00307}00307 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00308}00308         SPI1-\/>CR2           \&= \string~SPI\_CR2\_RXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00309}00309         SPI1-\/>CR2           \&= \string~SPI\_CR2\_TXDMAEN;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00310}00310 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00311}00311         SPI1-\/>CR1           \&= \string~SPI\_CR1\_SPE;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00312}00312 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00313}00313     \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00314}00314 \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00315}00315 }
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00319}00319 \textcolor{keywordtype}{void}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00320}\mbox{\hyperlink{drv__spi_8c_a877135f6494d6923d6f6ec32d75d9eeb}{00320}} \mbox{\hyperlink{drv__spi_8c_a877135f6494d6923d6f6ec32d75d9eeb}{DMA2\_Stream3\_IRQHandler}}(\textcolor{keywordtype}{void})}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00321}00321 \{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00322}00322     \textcolor{keywordflow}{if}(DMA2-\/>LISR \& DMA\_LISR\_TCIF3)\{}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00323}00323         DMA2-\/>LIFCR     |= DMA\_LIFCR\_CTCIF3;}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00324}00324     \}}
\DoxyCodeLine{\Hypertarget{drv__spi_8c_source_l00325}00325 \}}

\end{DoxyCode}
